local modem = peripheral.wrap("right") -- or whichever side
local channel = 1

if not modem then
    print("No modem found!")
    return
end

modem.open(channel)

local speedometerRunning = false

local function listenForButton()
    while true do
        local event, side, senderChannel, replyChannel, message, distance = os.pullEvent("modem_message")
        if senderChannel == channel and message == "button_pressed" then
            os.queueEvent("toggle_speedometer")
        end
    end
end

local function manageSpeedometer()
    while true do
        local event = os.pullEvent("toggle_speedometer")
        if speedometerRunning then
            os.queueEvent("shutdown_speedometer")
        else
            os.queueEvent("start_speedometer")
        end
    end
end

parallel.waitForAny(listenForButton, manageSpeedometer)
